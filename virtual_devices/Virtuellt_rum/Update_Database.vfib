{"name":"Update Database","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"0","log":"","logTemp":"","mainLoop":"","visible":"true","rows":[{"type":"button","elements":[{"id":1,"lua":true,"waitForResponse":false,"caption":"Temperature &amp; Humidity","name":"temphumidity","empty":false,"msg":"local updatechart = Net.FHttp(\"192.168.0.10\")\nlocal deviceType = \"temperatureSensor\" \nlocal deviceType2 = \"humiditySensor\" \nlocal i = 0 \nlocal maxNodeID = 500\nlocal user = 'username'\nlocal pwd = 'password'\n\nupdatechart:setBasicAuthentication(user, pwd);\nfor i = 0, maxNodeID do\n  local type = fibaro:getType(i);\n  x , y = string.find(type, deviceType) or string.find(type, deviceType2) \n  if x ~= nil then \n    local deviceName = fibaro:getName(i) \n    local deviceValue = fibaro:getValue(i, \"value\") \n    deviceName = string.gsub(deviceName, \"%s+\", \"%%20\");\n    payload = \"/fibaro-stats/data_post.php?type=\" .. type .. \"&name=\" .. deviceName .. \"&value=\" .. deviceValue.. \"&id=\" .. i \n    response, status, errorCode = updatechart:GET(payload)\n    --fibaro:debug('response=' .. response .. ', status=' .. status .. ', errorCode=' .. errorCode)\n    if (status == 200) then\n      --fibaro:debug('Uploaded ' .. deviceName .. '=' .. deviceValue)\n    else\n      fibaro:debug('Error')\n    end\n  end \nend \nfibaro:debug('devices uploaded');\n","buttonIcon":0,"favourite":false,"main":true}]},{"type":"button","elements":[{"id":2,"lua":true,"waitForResponse":false,"caption":"Temperature &amp; Weather","name":"weather","empty":false,"msg":"local updatechart = Net.FHttp(\"192.168.0.10\") \nlocal deviceName = fibaro:getName(3) \nlocal data0 = tonumber(fibaro:getValue(3, \"Temperature\")) \nlocal data1 = tonumber(fibaro:getValue(3, \"Humidity\"))\nlocal user = 'username'\nlocal pwd = 'password'\n\nupdatechart:setBasicAuthentication(user, pwd);\npayload = \"/fibaro-stats/data_post.php?type=temperature_sensor&name=\" .. deviceName .. \"&value=\".. data0.. \"&id=900\" \nresponse, status, errorCode = updatechart:GET(payload) \npayload = \"/fibaro-stats/data_post.php?type=humidity_sensor&name=\" .. deviceName .. \"&value=\".. data1.. \"&id=901\" \nresponse, status, errorCode = updatechart:GET(payload)\n\nfibaro:debug(\"Weather uploaded\");\n","buttonIcon":0,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":3,"lua":true,"waitForResponse":false,"caption":"Consumption","name":"consumption","empty":false,"msg":"local updatechart = Net.FHttp(\"192.168.0.10\") \nlocal deviceUnit = \"W\" \nlocal i = 0 \nlocal maxNodeID = 500\nlocal user = 'username'\nlocal pwd = 'password'\n\nupdatechart:setBasicAuthentication(user, pwd);\nfor i = 0, maxNodeID do \n  local type = fibaro:get(i, 'unitSensor'); \n  local type2 = fibaro:get(i, 'unit');\n  fibaro:debug('type=' .. type .. ', type2='.. type2)\n  local deviceValue = \"\" \n  x , y = string.find(type, deviceUnit) or string.find(type2, deviceUnit) \n\n  if x ~= nill or y ~= nill then \n    local deviceName = fibaro:getName(i); \n    if fibaro:getType(i) == \"multilevelSensor\" then \n      deviceValue = fibaro:getValue(i, \"value\") \n    else \n      deviceValue = fibaro:getValue(i, \"valueSensor\") \n    end \n    deviceName = string.gsub(deviceName, \"%s+\", \"%%20\");\n    payload = \"/fibaro-stats/data_post.php?type=consumption&name=\" .. deviceName .. \"&value=\" .. deviceValue.. \"&id=\".. i \n    response, status, errorCode = updatechart:GET(payload);\n  end \nend \nfibaro:debug('Devices uploaded');\n","buttonIcon":0,"favourite":false,"main":false}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}
